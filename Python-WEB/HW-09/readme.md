# Реализуем небольшой проект

Создадим базу данных **Sqlite** с использованием ORM пакета [**sqlalchemy**](https://www.sqlalchemy.org/), а так же используем пакет [**alembic**](https://alembic.sqlalchemy.org/en/latest/) для создания и контроля миграций.

В итоге мы получим небольшой "ToDo" проект, в котором будут задачи, у задач будут подчиненные пункты с описанием и контролем выполнения. Так же будет возможность добавить к задачам теги.

1. Создаем папку проекта
2. Создаем виртуальное окружение и активируем его
3. Устанавливаем пакет **alembic** `pip install alembic` (пакет **sqlalchemy** установится вместе с **alembic**)
4. Можно проверить окружение командой `pip list`
   минимальный перечень должен быть таким:
   ```
   Package Version
   alembic 1.7.5
   greenlet 1.1.2
   Mako 1.1.6
   MarkupSafe 2.0.1
   pip 20.2.3
   setuptools 49.2.1
   SQLAlchemy 1.4.27
   ```
5. Теперь можно инициализировать окружение **alembic** при помощи команды:  
    `alembic init alembic`  
    Этот вызов создаст папку с именем `alembic` внутри вашего проекта, а так же файл `alembic.ini` с настройками.  
    Теперь настроим окружение:

   - Найдем в файле `alembic.ini` строку
     ```
     sqlalchemy.url = driver://user:pass@localhost/dbname
     ```
     и напишем в ней путь к нашей БД
     ```
     sqlalchemy.url = sqlite:///dbname.db
     ```
   - Так как мы будем использовать автогенерацию SQL скриптов в миграциях `alembic` нам нужно сообщить об этом окружению в файле `env.py` который расположен в папке `alembic`. Откроем его и первым делом импортируем нашу декларативную базу из `model.py`
     ```
     from models import Base
     ```
   - Далее найдем строку:
     ```
     target_metadata = None
     ```
     и вместо `None` укажем наши метаданные:
     ```
     target_metadata = Base.metadata
     ```

6. Теперь создаем файл `models.py` в котором опишем ORM классы с использованием **sqlalchemy**
7. Создав одну модель можно выполнить миграцию для проверки общей работоспособности.  
    Для этого выполним команду `alembic revision --autogenerate -m 'Add first table'`
   на этом этапе уже должна создаться ваша БД но пока там будет только одна таблица с версиями миграций **alembic**, также в папке `alembic\versions` появится `.py` файл
   со скриптом миграции - на него можно посмотреть)  
   Для применения миграции и создания таблиц нашей модели выполним команду `alembic upgrade head` вот теперь миграция создаст таблицы в вашей БД
